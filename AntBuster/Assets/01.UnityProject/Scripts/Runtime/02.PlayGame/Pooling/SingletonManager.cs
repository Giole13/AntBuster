using System.Collections;
using System.Collections.Generic;
using UnityEngine;

public class SingletonManager : SingletonBase<SingletonManager>
{

    private Stack<GameObject> bulletPool = default;     // 계속 쓰이는 풀링전용 스택


    /// <summary>
    /// 오브젝트 풀링할 불릿 선택
    /// </summary>
    public void SetBulletPool()
    {
        int bulletQuantity = 20;    // 총알 갯수
        GameObject Objs = GioleFunc.GetRootObj(GioleData.OBJ_NAME_GAMEOBJS);

        bulletPool = new Stack<GameObject>();
        GameObject bulletObj = Objs.FindChildObj("Bullet");
        GameObject bullePoolObj = Objs.FindChildObj("BulletPool");

        GameObject bullet_ = default;

        for (int i = 0; i < bulletQuantity; ++i)
        {
            bullet_ = Instantiate(bulletObj, bullePoolObj.transform);
            bullet_.name = $"Bullet {i}";

            // 불릿 풀 스택에 불릿 풀 넣기
            bulletPool.Push(bullet_);
        }
    }


    /// <summary>
    /// 풀링에서 꺼내 쓰는 함수
    /// </summary>
    public void UseBulletPool(GameObject myselfObj, Vector2 dir, float bulletSpeed)
    {
        myselfObj.GetRect();
        GameObject bullet_ = bulletPool.Pop();
        bullet_.SetAnchoredPos(myselfObj.GetRect().anchoredPosition);
        bullet_.GetComponent<BulletController>().
            SetBulletDirection(dir, bulletSpeed);
    }

    public void ReloadBullet(GameObject bullet_)
    {
        bulletPool.Push(bullet_);
    }


    /// <summary>
    /// 터렛 가져와서 지정 위치에다가 넣어주는 함수
    /// </summary>
    public void SetTurret(Vector2 position_)
    {
        GioleFunc.GetRootObj(GioleData.OBJ_NAME_UI).FindChildObj("BasicTurretIcon").
            GetComponent<BasicTurretIconController>().SetTurretToClick(position_);
    }


    /// <summary>
    /// 스코어를 증가시키는 함수
    /// </summary>
    public void PlusScoreNum(int score_)
    {
        GioleFunc.GetRootObj("GameManager").GetComponent<GameManager>().
            PlusScoreNum(score_);
    }


    /// <summary>
    /// 플레이어 목숨 관리 함수
    /// </summary>
    /// <param name="typeBool">true면 증감, false면 가감</param>
    public void PlayerLifeControl(bool typeBool)
    {
        GameManager manager = GioleFunc.GetRootObj("GameManager").
            GetComponent<GameManager>();
        if (typeBool == true)
        {
            manager.PlayerLifePlus();
        }
        else if (typeBool == false)
        {
            manager.PlayerLifeMinus();
        }
    }


    /// <summary>
    /// 케이크의 애니메이션 관리 함수
    /// </summary>
    /// <param name="typeBool">true면 증감, false면 가감</param>
    public void CakeAniControl(bool typeBool)
    {
        GameManager manager = GioleFunc.GetRootObj("GameManager").
            GetComponent<GameManager>();
        if (typeBool == true)
        {
            manager.CakeAnimatorPlus();
        }
        else if (typeBool == false)
        {
            manager.CakeAnimatorMinus();
        }
    }

    /// <summary>
    /// 실행하면 포탑의 정보를 보여주는 함수
    /// </summary>
    /// 공격속도, 사거리, 투사체 속도, 공격력
    public void SetTurretInterface(float attackSpeed_, float range_,
        float bulletSpeed_, int bulletDamage_)
    {
        GameObject turretInterfaceObj = GioleFunc.GetRootObj(GioleData.OBJ_NAME_UI).
            FindChildObj(GioleData.OBJ_NAME_InformationWindow);

        turretInterfaceObj.SetActive(true);
        turretInterfaceObj.SetTmpText(
            $"공격 속도 : {attackSpeed_}\t사거리 : {range_}\n" +
            $"투사체 속도 : {bulletSpeed_}\t공격력 : {bulletDamage_}"
            );
    }


    /// <summary>
    /// 실행하면 개미의 정보를 보여주는 함수
    /// </summary>
    public void SetAntInterface(int level_, int antMaxHp_,int antCurrentHp_, float antSpeed_)
    {
        GameObject turretInterfaceObj = GioleFunc.GetRootObj(GioleData.OBJ_NAME_UI).
            FindChildObj(GioleData.OBJ_NAME_InformationWindow);

        turretInterfaceObj.SetActive(true);
        turretInterfaceObj.SetTmpText(
            $"레벨 : {level_}\n" +
            $"체력 : {antCurrentHp_} / {antMaxHp_}\t" +
            $"이동속도 : {antSpeed_}"
            );
    }


    /// <summary>
    /// 레벨을 올려해주는 함수
    /// </summary>
    public void SetLevel(int level_)
    {
        GameObject levelObj = GioleFunc.GetRootObj(GioleData.OBJ_NAME_UI).
            FindChildObj("Level");

        levelObj.SetTmpText($"{level_}");

    }
}
